{"ast":null,"code":"import axios from 'axios';\nexport default {\n  name: 'CheckOut',\n\n  data() {\n    return {\n      cart: {\n        items: []\n      },\n      stripe: {},\n      card: {},\n      first_name: '',\n      last_name: '',\n      email: '',\n      phone: '',\n      address: '',\n      zipcode: '',\n      place: '',\n      errors: []\n    };\n  },\n\n  methods: {\n    getItemTotal(item) {\n      return item.quantity * item.product.price;\n    },\n\n    submitForm() {\n      this.errors = [];\n\n      if (this.first_name == '') {\n        this.errors.push('The first name field is missing');\n      }\n\n      if (this.last_name === '') {\n        this.errors.push('The last name field is missing!');\n      }\n\n      if (this.email === '') {\n        this.errors.push('The email field is missing!');\n      }\n\n      if (this.phone === '') {\n        this.errors.push('The phone field is missing!');\n      }\n\n      if (this.address === '') {\n        this.errors.push('The address field is missing!');\n      }\n\n      if (this.zipcode === '') {\n        this.errors.push('The zip code field is missing!');\n      }\n\n      if (this.place === '') {\n        this.errors.push('The place field is missing!');\n      }\n\n      if (!this.errors.length) {\n        this.$store.commit('setIsLoading', true);\n        this.stripe.createToken(this.card).then(result => {\n          //verilen cart bilgisine gore token donur geriye \n          if (result.error) {\n            this.$store.commit('setIsLoading', false);\n            this.errors.push('Something went wrong Stripe.Please try again');\n            console.log(result.error.message);\n          } else {\n            this.stripeTokenHandler(result.token);\n          }\n        });\n      }\n    },\n\n    async stripeTokenHandler(token) {\n      const items = [];\n\n      for (let i = 0; i < this.cart.items; i++) {\n        const item = this.cart.items[i];\n        const obj = {\n          product: item.product.id,\n          quantity: item.quantity,\n          price: item.product.price * item.quantity\n        };\n        items.push(obj);\n      }\n\n      const data = {\n        'first_name': this.first_name,\n        'last_name': this.last_name,\n        'email': this.email,\n        'address': this.address,\n        'zipcode': this.zipcode,\n        'place': this.place,\n        'phone': this.phone,\n        'items': items,\n        'stripe_token': token.id\n      };\n      await axios.post('api/v1/checkout/', data).then(response => {\n        this.$store.commit('clearCart');\n        this.$router.push('/cart/success/');\n      }).catch(err => {\n        this.errors.push('Something went wrong.Please try again');\n        console.log(err);\n      });\n      this.$store.commit('setIsLoading', false);\n    }\n\n  },\n\n  mounted() {\n    window.document.title = 'Djackets | Checkout';\n    this.cart = this.$store.state.cart; //items this data object\n\n    if (this.cartTotalLenght > 0) {\n      this.stripe = Stripe('sk_test_51LHUajFSkTD6hm2jjsVcyEptj3cjaeanryVj644oHSZNsNY7qfy7aixdb4TdSutW68NI69CF2TV7q0P5D9n0KtET007RAuWLXd');\n      console.log('Success Stripe Token Created ', this.stripe);\n      console.log('Stripe Elements ', this.stripe.elements());\n      const elements = this.stripe.elements();\n      this.card = elements.create('card', {\n        hidePostalCode: true\n      }); //bank kartidi bu elebil kartin icinde pul filani gosterir\n\n      this.card.mount('cart-element');\n    }\n  },\n\n  computed: {\n    cartTotalPrice() {\n      return this.cart.items.reduce((acc, curVal) => {\n        return acc += curVal.product.price * curVal.quantity;\n      }, 0);\n    },\n\n    cartTotalLenght() {\n      return this.cart.items.reduce((acc, curVal) => {\n        return acc += curVal.quantity;\n      }, 0);\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["axios","name","data","cart","items","stripe","card","first_name","last_name","email","phone","address","zipcode","place","errors","methods","getItemTotal","item","quantity","product","price","submitForm","push","length","$store","commit","createToken","then","result","error","console","log","message","stripeTokenHandler","token","i","obj","id","post","response","$router","catch","err","mounted","window","document","title","state","cartTotalLenght","Stripe","elements","create","hidePostalCode","mount","computed","cartTotalPrice","reduce","acc","curVal"],"sourceRoot":"","sources":["C:\\Users\\user\\Desktop\\django_vue_ecommerce\\djackets_vue\\src\\views\\CheckOut.vue"],"sourcesContent":["<template>\r\n    <div class=\"page-checkout\">\r\n        <div class=\"columns is-multiline\">\r\n            <div class=\"column is-12\">\r\n                <h1 class=\"title\">Checkout</h1>\r\n            </div>\r\n            <div class=\"column is-12 box\">\r\n                <table class=\"table is-fullwidth\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Product</th>\r\n                            <th>Price</th>\r\n                            <th>Quantity</th>\r\n                            <th>Total</th>\r\n                            <th></th>\r\n                            <th></th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        <tr v-for=\"item in cart.items\" :key=\"item.id\">\r\n                            <td>{{item.product.name}}</td>\r\n                            <td>${{item.product.price}}</td>\r\n                            <td>{{item.quantity}}</td>\r\n                            <td>${{getItemTotal(item).toFixed(2)}}</td>\r\n                        </tr>\r\n                    </tbody>\r\n                    <tfoot>\r\n                        <tr>\r\n                            <td colspan=\"2\">Total</td>\r\n                            <td>{{cartTotalLenght}}</td>\r\n                            <td>{{cartTotalLenght}}</td>\r\n                            <td>${{cartTotalPrice.toFixed(2)}}</td>\r\n                            <td></td>\r\n                        </tr>\r\n                    </tfoot>\r\n                </table>\r\n            </div>\r\n\r\n            <div class=\"column is-12 box\">\r\n                <h2 class=\"subtitle\">Shipping Details</h2>\r\n                <p class=\"has-text-grey mb-4 \">*All Fields Are Required</p>\r\n                <div class=\"columns is-multiline\">\r\n                    <div class=\"column is-6\">\r\n                        <div class=\"field\">\r\n                            <label>First Name*</label>\r\n                            <div class=\"control\">\r\n                                <input type=\"text\" class=\"input\" v-model=\"first_name\">\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"field\">\r\n                            <label>Last Name*</label>\r\n                            <div class=\"control\">\r\n                                <input type=\"text\" class=\"input\" v-model=\"last_name\">\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"field\">\r\n                            <label>Email*</label>\r\n                            <div class=\"control\">\r\n                                <input type=\"email\" class=\"input\" v-model=\"email\">\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"field\">\r\n                            <label>Phone*</label>\r\n                            <div class=\"control\">\r\n                                <input type=\"text\" class=\"input\" v-model=\"phone\">\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"column is-6\">\r\n                        <div class=\"field\">\r\n                            <label>Address*</label>\r\n                            <div class=\"control\">\r\n                                <input type=\"text\" class=\"input\" v-model=\"address\">\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div class=\"field\">\r\n                            <label>Zip code*</label>\r\n                            <div class=\"control\">\r\n                                <input type=\"text\" class=\"input\" v-model=\"zipcode\">\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div class=\"field\">\r\n                            <label>Place*</label>\r\n                            <div class=\"control\">\r\n                                <input type=\"text\" class=\"input\" v-model=\"place\">\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                    <div class=\"notification is-danger mt-4\" v-if=\"errors.length\">\r\n                        <p v-for=\"error in errors\" :key=\"error\">{{error}}</p>\r\n                    </div>\r\n                    \r\n                    <hr>\r\n\r\n                    <div id=\"cart-element\" class=\"mb-5\"></div>\r\n\r\n                    <template v-if=\"cartTotalLenght\">\r\n                        <hr>\r\n                        <button class=\"button is-dark\" @click=\"submitForm\">Pay With Stripe</button>\r\n                    </template>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import axios from 'axios'\r\n\r\n    export default{\r\n        name:'CheckOut',\r\n        data(){\r\n            return{\r\n                cart: {\r\n                    items: []\r\n                },\r\n                stripe: {},\r\n                card: {},\r\n                first_name: '',\r\n                last_name: '',\r\n                email: '',\r\n                phone: '',\r\n                address: '',\r\n                zipcode: '',\r\n                place: '',\r\n                errors: []\r\n            }\r\n        },\r\n        methods:{\r\n            getItemTotal(item){\r\n                return item.quantity*item.product.price\r\n            },\r\n            submitForm(){\r\n                this.errors=[]\r\n\r\n                if(this.first_name==''){\r\n                    this.errors.push('The first name field is missing')\r\n                }\r\n                if (this.last_name === '') {\r\n                this.errors.push('The last name field is missing!')\r\n                }\r\n                if (this.email === '') {\r\n                    this.errors.push('The email field is missing!')\r\n                }\r\n                if (this.phone === '') {\r\n                    this.errors.push('The phone field is missing!')\r\n                }\r\n                if (this.address === '') {\r\n                    this.errors.push('The address field is missing!')\r\n                }\r\n                if (this.zipcode === '') {\r\n                    this.errors.push('The zip code field is missing!')\r\n                }\r\n                if (this.place === '') {\r\n                    this.errors.push('The place field is missing!')\r\n                }\r\n\r\n                if(!this.errors.length){\r\n                    this.$store.commit('setIsLoading',true)\r\n                    this.stripe.createToken(this.card).then((result)=>{//verilen cart bilgisine gore token donur geriye \r\n                        if(result.error){\r\n                            this.$store.commit('setIsLoading',false)\r\n                            this.errors.push('Something went wrong Stripe.Please try again')\r\n                            console.log(result.error.message)\r\n                        }\r\n                        else{\r\n                            this.stripeTokenHandler(result.token)\r\n                        }\r\n                    })\r\n                }\r\n            },\r\n            async stripeTokenHandler(token){\r\n                const items = []\r\n                for(let i=0;i<this.cart.items;i++){\r\n                    const item = this.cart.items[i]\r\n                    const obj = {\r\n                        product:item.product.id,\r\n                        quantity:item.quantity,\r\n                        price:item.product.price*item.quantity\r\n                    }\r\n                    items.push(obj)\r\n                }\r\n                \r\n                const data = {\r\n                    'first_name': this.first_name,\r\n                    'last_name': this.last_name,\r\n                    'email': this.email,\r\n                    'address': this.address,\r\n                    'zipcode': this.zipcode,\r\n                    'place': this.place,\r\n                    'phone': this.phone,\r\n                    'items': items,\r\n                    'stripe_token': token.id\r\n                }\r\n\r\n                await axios.post('api/v1/checkout/',data)\r\n                    .then((response)=>{\r\n                        this.$store.commit('clearCart')\r\n                        this.$router.push('/cart/success/')\r\n                    })\r\n                    .catch((err)=>{\r\n                        this.errors.push('Something went wrong.Please try again')\r\n                        console.log(err)\r\n                    })\r\n                    this.$store.commit('setIsLoading',false)\r\n            }\r\n        },\r\n        mounted(){\r\n            window.document.title = 'Djackets | Checkout'\r\n            this.cart = this.$store.state.cart //items this data object\r\n\r\n            if(this.cartTotalLenght > 0){\r\n                this.stripe = Stripe('sk_test_51LHUajFSkTD6hm2jjsVcyEptj3cjaeanryVj644oHSZNsNY7qfy7aixdb4TdSutW68NI69CF2TV7q0P5D9n0KtET007RAuWLXd')\r\n                console.log('Success Stripe Token Created ',  this.stripe)\r\n                console.log('Stripe Elements ', this.stripe.elements())\r\n                const elements = this.stripe.elements()\r\n                this.card=elements.create('card',{hidePostalCode:true})//bank kartidi bu elebil kartin icinde pul filani gosterir\r\n\r\n                this.card.mount('cart-element')\r\n            }\r\n        },\r\n        computed:{\r\n            cartTotalPrice(){\r\n                return this.cart.items.reduce((acc,curVal)=>{\r\n                    return acc+=curVal.product.price*curVal.quantity\r\n                },0)\r\n            },\r\n            cartTotalLenght(){\r\n                return this.cart.items.reduce((acc,curVal)=>{\r\n                    return acc+=curVal.quantity\r\n                },0)\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style>\r\n\r\n</style>"]},"metadata":{},"sourceType":"module"}