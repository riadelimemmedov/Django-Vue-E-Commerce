{"ast":null,"code":"import axios from 'axios';\nexport default {\n  name: 'CheckOut',\n\n  data() {\n    return {\n      cart: {\n        items: []\n      },\n      stripe: {},\n      card: {},\n      first_name: '',\n      last_name: '',\n      email: '',\n      phone: '',\n      address: '',\n      zipcode: '',\n      place: '',\n      errors: []\n    };\n  },\n\n  methods: {\n    getItemTotal(item) {\n      return item.quantity * item.product.price;\n    },\n\n    submitForm() {\n      this.errors = [];\n\n      if (this.first_name == '') {\n        this.errors.push('The first name field is missing');\n      }\n\n      if (this.last_name === '') {\n        this.errors.push('The last name field is missing!');\n      }\n\n      if (this.email === '') {\n        this.errors.push('The email field is missing!');\n      }\n\n      if (this.phone === '') {\n        this.errors.push('The phone field is missing!');\n      }\n\n      if (this.address === '') {\n        this.errors.push('The address field is missing!');\n      }\n\n      if (this.zipcode === '') {\n        this.errors.push('The zip code field is missing!');\n      }\n\n      if (this.place === '') {\n        this.errors.push('The place field is missing!');\n      }\n\n      if (!this.errors.length) {\n        this.$store.commit('setIsLoading', true);\n        this.stripe.createToken(this.card).then(result => {\n          //verilen cart bilgisine gore token donur geriye \n          if (result.error) {\n            this.$store.commit('setIsLoading', false);\n            this.errors.push('Something went wrong Stripe.Please try again');\n            console.log(result.error.message);\n          } else {\n            this.stripeTokenHandler(result.token);\n          }\n        });\n      }\n    },\n\n    async stripeTokenHandler(token) {\n      const items = [];\n\n      for (let i = 0; i < this.cart.items; i++) {\n        const item = this.cart.items[i];\n        const obj = {\n          product: item.product.id,\n          quantity: item.quantity,\n          price: item.product.price * item.quantity\n        };\n        items.push(obj);\n      }\n\n      const data = {\n        'first_name': this.first_name,\n        'last_name': this.last_name,\n        'email': this.email,\n        'address': this.address,\n        'zipcode': this.zipcode,\n        'place': this.place,\n        'phone': this.phone,\n        'items': items,\n        'stripe_token': token.id\n      };\n      await axios.post('api/v1/checkout/');\n    }\n\n  },\n\n  mounted() {\n    window.document.title = 'Djackets | Checkout';\n    this.cart = this.$store.state.cart; //items this data object\n  },\n\n  computed: {\n    cartTotalPrice() {\n      return this.cart.items.reduce((acc, curVal) => {\n        return acc += curVal.product.price * curVal.quantity;\n      }, 0);\n    },\n\n    cartTotalLenght() {\n      return this.cart.items.reduce((acc, curVal) => {\n        return acc += curVal.quantity;\n      }, 0);\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["axios","name","data","cart","items","stripe","card","first_name","last_name","email","phone","address","zipcode","place","errors","methods","getItemTotal","item","quantity","product","price","submitForm","push","length","$store","commit","createToken","then","result","error","console","log","message","stripeTokenHandler","token","i","obj","id","post","mounted","window","document","title","state","computed","cartTotalPrice","reduce","acc","curVal","cartTotalLenght"],"sourceRoot":"","sources":["C:\\Users\\user\\Desktop\\django_vue_ecommerce\\djackets_vue\\src\\views\\CheckOut.vue"],"sourcesContent":["<template>\r\n    <div class=\"page-checkout\">\r\n        <div class=\"columns is-multiline\">\r\n            <div class=\"column is-12\">\r\n                <h1 class=\"title\">Checkout</h1>\r\n            </div>\r\n            <div class=\"column is-12 box\">\r\n                <table class=\"table is-fullwidth\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Product</th>\r\n                            <th>Price</th>\r\n                            <th>Quantity</th>\r\n                            <th>Total</th>\r\n                            <th></th>\r\n                            <th></th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        <tr v-for=\"item in cart.items\" :key=\"item.id\">\r\n                            <td>{{item.product.name}}</td>\r\n                            <td>${{item.product.price}}</td>\r\n                            <td>{{item.quantity}}</td>\r\n                            <td>${{getItemTotal(item).toFixed(2)}}</td>\r\n                        </tr>\r\n                    </tbody>\r\n                    <tfoot>\r\n                        <tr>\r\n                            <td colspan=\"2\">Total</td>\r\n                            <td>{{cartTotalLenght}}</td>\r\n                            <td>{{cartTotalLenght}}</td>\r\n                            <td>${{cartTotalPrice.toFixed(2)}}</td>\r\n                            <td></td>\r\n                        </tr>\r\n                    </tfoot>\r\n                </table>\r\n            </div>\r\n\r\n            <div class=\"column is-12 box\">\r\n                <h2 class=\"subtitle\">Shipping Details</h2>\r\n                <p class=\"has-text-grey mb-4 \">*All Fields Are Required</p>\r\n                <div class=\"columns is-multiline\">\r\n                    <div class=\"column is-6\">\r\n                        <div class=\"field\">\r\n                            <label>First Name*</label>\r\n                            <div class=\"control\">\r\n                                <input type=\"text\" class=\"input\" v-model=\"first_name\">\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"field\">\r\n                            <label>Last Name*</label>\r\n                            <div class=\"control\">\r\n                                <input type=\"text\" class=\"input\" v-model=\"last_name\">\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"field\">\r\n                            <label>Email*</label>\r\n                            <div class=\"control\">\r\n                                <input type=\"email\" class=\"input\" v-model=\"email\">\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"field\">\r\n                            <label>Phone*</label>\r\n                            <div class=\"control\">\r\n                                <input type=\"text\" class=\"input\" v-model=\"phone\">\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"column is-6\">\r\n                        <div class=\"field\">\r\n                            <label>Address*</label>\r\n                            <div class=\"control\">\r\n                                <input type=\"text\" class=\"input\" v-model=\"address\">\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div class=\"field\">\r\n                            <label>Zip code*</label>\r\n                            <div class=\"control\">\r\n                                <input type=\"text\" class=\"input\" v-model=\"zipcode\">\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div class=\"field\">\r\n                            <label>Place*</label>\r\n                            <div class=\"control\">\r\n                                <input type=\"text\" class=\"input\" v-model=\"place\">\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                    <div class=\"notification is-danger mt-4\" v-if=\"errors.length\">\r\n                        <p v-for=\"error in errors\" :key=\"error\">{{error}}</p>\r\n                    </div>\r\n                    \r\n                    <hr>\r\n\r\n                    <div id=\"cart-element\" class=\"mb-5\"></div>\r\n\r\n                    <template v-if=\"cartTotalLenght\">\r\n                        <hr>\r\n                        <button class=\"button is-dark\" @click=\"submitForm\">Pay With Stripe</button>\r\n                    </template>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import axios from 'axios'\r\n\r\n    export default{\r\n        name:'CheckOut',\r\n        data(){\r\n            return{\r\n                cart: {\r\n                    items: []\r\n                },\r\n                stripe: {},\r\n                card: {},\r\n                first_name: '',\r\n                last_name: '',\r\n                email: '',\r\n                phone: '',\r\n                address: '',\r\n                zipcode: '',\r\n                place: '',\r\n                errors: []\r\n            }\r\n        },\r\n        methods:{\r\n            getItemTotal(item){\r\n                return item.quantity*item.product.price\r\n            },\r\n            submitForm(){\r\n                this.errors=[]\r\n\r\n                if(this.first_name==''){\r\n                    this.errors.push('The first name field is missing')\r\n                }\r\n                if (this.last_name === '') {\r\n                this.errors.push('The last name field is missing!')\r\n                }\r\n                if (this.email === '') {\r\n                    this.errors.push('The email field is missing!')\r\n                }\r\n                if (this.phone === '') {\r\n                    this.errors.push('The phone field is missing!')\r\n                }\r\n                if (this.address === '') {\r\n                    this.errors.push('The address field is missing!')\r\n                }\r\n                if (this.zipcode === '') {\r\n                    this.errors.push('The zip code field is missing!')\r\n                }\r\n                if (this.place === '') {\r\n                    this.errors.push('The place field is missing!')\r\n                }\r\n\r\n                if(!this.errors.length){\r\n                    this.$store.commit('setIsLoading',true)\r\n                    this.stripe.createToken(this.card).then((result)=>{//verilen cart bilgisine gore token donur geriye \r\n                        if(result.error){\r\n                            this.$store.commit('setIsLoading',false)\r\n                            this.errors.push('Something went wrong Stripe.Please try again')\r\n                            console.log(result.error.message)\r\n                        }\r\n                        else{\r\n                            this.stripeTokenHandler(result.token)\r\n                        }\r\n                    })\r\n                }\r\n                \r\n            },\r\n            async stripeTokenHandler(token){\r\n                const items = []\r\n                for(let i=0;i<this.cart.items;i++){\r\n                    const item = this.cart.items[i]\r\n                    const obj = {\r\n                        product:item.product.id,\r\n                        quantity:item.quantity,\r\n                        price:item.product.price*item.quantity\r\n                    }\r\n                    items.push(obj)\r\n                }\r\n                \r\n                const data = {\r\n                    'first_name': this.first_name,\r\n                    'last_name': this.last_name,\r\n                    'email': this.email,\r\n                    'address': this.address,\r\n                    'zipcode': this.zipcode,\r\n                    'place': this.place,\r\n                    'phone': this.phone,\r\n                    'items': items,\r\n                    'stripe_token': token.id\r\n                }\r\n\r\n                await axios.post('api/v1/checkout/')\r\n            }\r\n        },\r\n        mounted(){\r\n            window.document.title = 'Djackets | Checkout'\r\n            this.cart = this.$store.state.cart //items this data object\r\n        },\r\n        computed:{\r\n            cartTotalPrice(){\r\n                return this.cart.items.reduce((acc,curVal)=>{\r\n                    return acc+=curVal.product.price*curVal.quantity\r\n                },0)\r\n            },\r\n            cartTotalLenght(){\r\n                return this.cart.items.reduce((acc,curVal)=>{\r\n                    return acc+=curVal.quantity\r\n                },0)\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style>\r\n\r\n</style>"]},"metadata":{},"sourceType":"module"}